{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-3">
        <div class="col-md-10">
            <h2>Manage Student Registrations</h2>
            <h4>Exam: <strong>{{ exam.subject }}</strong></h4>
            <p>Date: {{ exam.date.strftime('%Y-%m-%d') }} | Time: {{ exam.start_time.strftime('%H:%M') }} - {{ exam.end_time.strftime('%H:%M') }}</p>
        </div>
        <div class="col-md-2 text-right">
            <a href="{{ url_for('main.manage_exams') }}" class="btn btn-secondary">Back to Exams</a>
        </div>
    </div>

    {% include '_flash_messages.html' %} {# Assuming you have a template for flashing messages #}

    <div class="card">
        <div class="card-header">
            Student List
        </div>
        <div class="card-body">
            {% if all_students %}
            <ul class="list-group list-group-flush">
                {% for student in all_students %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ student.name }}</strong> (ID: {{ student.student_id_number }})
                        {% if student.id in registered_student_ids %}
                            <span class="badge badge-success ml-2">Registered</span>
                        {% else %}
                            <span class="badge badge-secondary ml-2">Not Registered</span>
                        {% endif %}
                    </div>
                    <div>
                        {% if student.id in registered_student_ids %}
                        <form action="{{ url_for('main.unregister_student_from_exam', exam_id=exam.id, student_id=student.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-warning btn-sm">Unregister</button>
                        </form>
                        {% else %}
                        <form action="{{ url_for('main.register_student_for_exam', exam_id=exam.id, student_id=student.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-primary btn-sm">Register</button>
                        </form>
                        {% endif %}
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="text-muted">No students found in the system. Please <a href="{{ url_for('main.add_student') }}">add students</a> first.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
